    public void testFailingSetAutoRefreshOnNonLooperThread() {
        final AtomicBoolean done = new AtomicBoolean(false);
        Thread thread = new Thread() {
            @Override
            public void run() {
                Realm realm = Realm.getInstance(getContext(), false);
                boolean autoRefresh = realm.isAutoRefresh();
                assertFalse(autoRefresh);
                try {
                    realm.setAutoRefresh(true);
                    fail();
                } catch (IllegalStateException ignored) {}
                done.set(true);
            }
        };
        thread.start();
        try {
            thread.join(1000);
        } catch (InterruptedException e) {
            fail();
        }
        assertTrue(done.get());
    }

