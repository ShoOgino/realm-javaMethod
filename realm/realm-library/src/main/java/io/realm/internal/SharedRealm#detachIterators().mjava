    // The detaching should happen before transaction begins.
    private void detachIterators() {
        for (WeakReference<Collection.Iterator> iteratorRef : iterators) {
            Collection.Iterator iterator = iteratorRef.get();
            if (iterator != null) {
                iterator.detach();
            }
        }
        iterators.clear();
    }

