    /**
     * Helper method for creating the proper Authenticate response. This method will set the appropriate error
     * depending on any HTTP response codes or IO errors.
     */
    static AuthenticateResponse createFrom(Response response) {
        String serverResponse;
        try {
            serverResponse = response.body().string();
        } catch (IOException e) {
            ObjectServerError error = new ObjectServerError(ErrorCode.IO_EXCEPTION, e);
            return new AuthenticateResponse(error);
        }
        RealmLog.debug("Authenticate response: " + serverResponse);
        if (response.code() != 200) {
            try {
                JSONObject obj = new JSONObject(serverResponse);
                String type = obj.getString("type");
                String hint = obj.optString("hint", null);
                String title = obj.optString("title", null);
                ErrorCode errorCode = ErrorCode.fromInt(obj.optInt("code", -1));
                ObjectServerError error = new ObjectServerError(errorCode, title, hint, type);
                return new AuthenticateResponse(error);
            } catch (JSONException e) {
                ObjectServerError error = new ObjectServerError(ErrorCode.JSON_EXCEPTION, "Server failed with " +
                        response.code() + ", but could not parse error.", e);
                return new AuthenticateResponse(error);
            }
        } else {
            return new AuthenticateResponse(serverResponse);
        }
    }

