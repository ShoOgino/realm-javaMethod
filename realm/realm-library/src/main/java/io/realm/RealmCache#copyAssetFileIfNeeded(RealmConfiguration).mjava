    /**
     * Copies Realm database file from Android asset directory to the directory given in the {@link RealmConfiguration}.
     * Copy is performed only at the first time when there is no Realm database file.
     *
     * @param configuration configuration object for Realm instance.
     * @throws RealmFileException if copying the file fails.
     */
    private static void copyAssetFileIfNeeded(RealmConfiguration configuration) {
        IOException exceptionWhenClose = null;
        if (configuration.hasAssetFile()) {
            File realmFile = new File(configuration.getRealmDirectory(), configuration.getRealmFileName());
            if (realmFile.exists()) {
                return;
            }

            InputStream inputStream = null;
            FileOutputStream outputStream = null;
            try {
                inputStream = configuration.getAssetFile();
                if (inputStream == null) {
                    throw new RealmFileException(RealmFileException.Kind.ACCESS_ERROR,
                            "Invalid input stream to asset file.");
                }

                outputStream = new FileOutputStream(realmFile);
                byte[] buf = new byte[4096];
                int bytesRead;
                while ((bytesRead = inputStream.read(buf)) > -1) {
                    outputStream.write(buf, 0, bytesRead);
                }
            } catch (IOException e) {
                throw new RealmFileException(RealmFileException.Kind.ACCESS_ERROR,
                        "Could not resolve the path to the Realm asset file.", e);
            } finally {
                if (inputStream != null) {
                    try {
                        inputStream.close();
                    } catch (IOException e) {
                        exceptionWhenClose = e;
                    }
                }
                if (outputStream != null) {
                    try {
                        outputStream.close();
                    } catch (IOException e) {
                        // Ignores this one if there was an exception when close inputStream.
                        if (exceptionWhenClose == null) {
                            exceptionWhenClose = e;
                        }
                    }
                }
            }

            // No other exception has been thrown, only the exception when close. So, throw it.
            if (exceptionWhenClose != null) {
                throw new RealmFileException(RealmFileException.Kind.ACCESS_ERROR, exceptionWhenClose);
            }
        }
    }

