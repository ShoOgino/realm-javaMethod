    /**
     * Copies Realm database file from Android asset directory to the directory given in the {@link RealmConfiguration}.
     * Copy is performed only at the first time when there is no Realm database file.
     *
     * @param configuration configuration object for Realm instance.
     * @throws IOException if copying the file fails.
     */
    private static void copyAssetFileIfNeeded(RealmConfiguration configuration) {
        if (configuration.hasAssetFile()) {
            File realmFile = new File(configuration.getRealmFolder(), configuration.getRealmFileName());
            if (realmFile.exists()) {
                return;
            }

            InputStream inputStream = null;
            FileOutputStream outputStream = null;
            try {
                inputStream = configuration.getAssetFile();
                if (inputStream == null) {
                    throw new RealmIOException("Invalid input stream to asset file.");
                }

                outputStream = new FileOutputStream(realmFile);
                byte[] buf = new byte[4096];
                int bytesRead;
                while ((bytesRead = inputStream.read(buf)) > -1) {
                    outputStream.write(buf, 0, bytesRead);
                }
            } catch (IOException e) {
                throw new RealmIOException("Could not resolve the path to the Realm asset file.", e);
            } finally {
                if (inputStream != null) {
                    try {
                        inputStream.close();
                    } catch (IOException e) {
                        // Ignore this exception because any significant errors should already have been handled
                    }
                }
                if (outputStream != null) {
                    try {
                        outputStream.close();
                    } catch (IOException e) {
                        throw new RealmIOException("Invalid output stream to " + realmFile.getPath(), e);
                    }
                }
            }
        }
    }

