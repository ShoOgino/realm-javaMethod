    /**
     * Compacts the Realm file defined by the given configuration.
     */
    public static boolean compactRealm(final RealmConfiguration configuration) {
        final AtomicBoolean result = new AtomicBoolean(false);

        RealmCache.invokeWithGlobalRefCount(configuration, new RealmCache.Callback() {
            @Override
            public void onResult(int count) {
                if (count != 0) {
                    throw new IllegalStateException("Cannot compact an open Realm");
                }
                result.set(SharedGroupManager.compact(configuration));
            }
        });

        return result.get();
    }

