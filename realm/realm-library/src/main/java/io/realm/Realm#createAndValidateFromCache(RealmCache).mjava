    private static Realm createAndValidateFromCache(RealmCache cache) {
        Realm realm = new Realm(cache);
        RealmConfiguration configuration = realm.configuration;

        final long requiredVersion = configuration.getSchemaVersion();

        final ColumnIndices columnIndices = RealmCache.findColumnIndices(cache.getTypedColumnIndicesArray(),
                requiredVersion);

        if (columnIndices != null) {
            // Copies global cache as a Realm local indices cache.
            realm.schema.setInitialColumnIndices(columnIndices);
        } else {
            // Initializes Realm schema if needed.
            try {
                initializeRealm(realm);
            } catch (RuntimeException e) {
                realm.doClose();
                throw e;
            }
        }

        return realm;
    }

