    @Test
    @RunTestInLooperThread
    public void changePassword_throwWhenUserIsLoggedOut() {
        String username = UUID.randomUUID().toString();
        String password = "password";
        SyncCredentials credentials = SyncCredentials.usernamePassword(username, password, true);
        SyncUser user = SyncUser.login(credentials, Constants.AUTH_URL);
        SyncManager.addAuthenticationListener(new AuthenticationListener() {
            @Override
            public void loggedIn(SyncUser user) {
                SyncManager.removeAuthenticationListener(this);
                // callback is happening on different thread, all assertions needs to be done on looper thread
                looperThread.postRunnable(new Runnable() {
                    @Override
                    public void run() {
                        fail("loggedIn should not be invoked");
                    }
                });
            }

            @Override
            public void loggedOut(SyncUser user) {
                SyncManager.removeAuthenticationListener(this);
                try {
                    user.changePassword("new-password");
                    looperThread.postRunnable(new Runnable() {
                        @Override
                        public void run() {
                            fail("changePassword should throw ObjectServerError (INVALID CREDENTIALS)");
                        }
                    });
                } catch (ObjectServerError expected) {
                }
                looperThread.testComplete();
            }
        });
        user.logout();
    }

