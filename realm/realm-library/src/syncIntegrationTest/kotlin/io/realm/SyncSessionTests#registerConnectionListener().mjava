    @Test
    @RunTestInLooperThread
    public void registerConnectionListener() {
        getSession(session -> {
            session.addConnectionChangeListener((oldState, newState) -> {
                if (newState == ConnectionState.DISCONNECTED) {
                    // Closing a Realm inside a connection listener doesn't work: https://github.com/realm/realm-java/issues/6249
                    looperThread.postRunnable(() -> looperThread.testComplete());
                }
            });
            session.stop();
        });
    }

