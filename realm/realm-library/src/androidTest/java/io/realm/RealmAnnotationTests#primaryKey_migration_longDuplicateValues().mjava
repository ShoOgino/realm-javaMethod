    // Test migrating primary key from string to long with existing data
    @Test
    public void primaryKey_migration_longDuplicateValues() {
        realm.beginTransaction();
        for (int i = 1; i <= 2; i++) {
            PrimaryKeyAsString obj = realm.createObject(PrimaryKeyAsString.class);
            obj.setId(1); // Create duplicate values
            obj.setName("String" + i);
        }

        Table table = realm.getTable(PrimaryKeyAsString.class);
        try {
            table.setPrimaryKey("id");
            fail("It should not be possible to set a primary key column which already contains duplicate values.");
        } catch (IllegalArgumentException ignored) {
            assertEquals(0, table.getPrimaryKey());
        } finally {
            realm.cancelTransaction();
        }
    }

