    @Test
    @UiThreadTest
    public void immediateNotificationsOnSameThread() {
        final AtomicBoolean success = new AtomicBoolean(false);
        final RealmChangeListener listener[] = new RealmChangeListener[1];
        realm = Realm.getInstance(realmConfig);
        listener[0] = new RealmChangeListener() {
            @Override
            public void onChange() {
                // Listener should only be called once
                assertFalse(success.get());
                success.set(true);
            }
        };
        realm.addChangeListener(listener[0]);
        realm.beginTransaction();
        realm.createObject(AllTypes.class);
        realm.commitTransaction();
        assertTrue(success.get());
    }

