    // We should not cache wrong configurations
    @Test
    public void dontCacheWrongConfigurations() throws IOException {
        Realm testRealm;
        String REALM_NAME = "encrypted.realm";
        configFactory.copyRealmFromAssets(context, REALM_NAME, REALM_NAME);
        RealmMigration realmMigration = TestHelper.prepareMigrationToNullSupportStep();

        RealmConfiguration wrongConfig = configFactory.createConfigurationBuilder()
                .name(REALM_NAME)
                .encryptionKey(TestHelper.SHA512("foo"))
                .migration(realmMigration)
                .schema(StringOnly.class)
                .build();

        RealmConfiguration rightConfig = configFactory.createConfigurationBuilder()
                .name(REALM_NAME)
                .encryptionKey(TestHelper.SHA512("realm"))
                .migration(realmMigration)
                .schema(StringOnly.class)
                .build();

        // Open Realm with wrong key
        try {
            Realm.getInstance(wrongConfig);
            fail();
        } catch (RealmFileException expected) {
            assertEquals(expected.getKind(), RealmFileException.Kind.ACCESS_ERROR);
        }

        // Try again with proper key
        testRealm = Realm.getInstance(rightConfig);
        assertNotNull(testRealm);
        testRealm.close();
    }

