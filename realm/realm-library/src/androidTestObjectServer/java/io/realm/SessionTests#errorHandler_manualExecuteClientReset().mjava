    // Check that we can manually execute the Client Reset.
    @Test
    @RunTestInLooperThread
    public void errorHandler_manualExecuteClientReset() {
        SyncUser user = createTestUser();
        String url = "realm://objectserver.realm.io/default";
        final SyncConfiguration config = configFactory.createSyncConfigurationBuilder(user, url)
                .errorHandler((session, error) -> {
                    if (error.getErrorCode() != ErrorCode.CLIENT_RESET) {
                        fail("Wrong error " + error.toString());
                        return;
                    }

                    final ClientResetRequiredError handler = (ClientResetRequiredError) error;
                    try {
                        handler.executeClientReset();
                        fail("All Realms should be closed before executing Client Reset can be allowed");
                    } catch(IllegalStateException ignored) {
                    }

                    // Execute Client Reset
                    looperThread.closeTestRealms();
                    handler.executeClientReset();

                    // Validate that files have been moved
                    assertFalse(handler.getOriginalFile().exists());
                    assertTrue(handler.getBackupFile().exists());
                    looperThread.testComplete();
                })
                .build();

        Realm realm = Realm.getInstance(config);
        looperThread.addTestRealm(realm);

        // Trigger error
        SyncManager.simulateClientReset(SyncManager.getOrCreateSession(config, null));
    }

