    // Check that a Client Reset is correctly reported.
    @Test
    @RunTestInLooperThread
    public void errorHandler_clientResetReported() {
        SyncUser user = createTestUser();
        String url = "realm://objectserver.realm.io/default";
        final SyncConfiguration config = configFactory.createSyncConfigurationBuilder(user, url)
                .errorHandler((session, error) -> {
                    if (error.getErrorCode() != ErrorCode.CLIENT_RESET) {
                        fail("Wrong error " + error.toString());
                        return;
                    }

                    final ClientResetRequiredError handler = (ClientResetRequiredError) error;
                    String filePathFromError = handler.getOriginalFile().getAbsolutePath();
                    String filePathFromConfig = session.getConfiguration().getPath();
                    assertEquals(filePathFromError, filePathFromConfig);
                    assertFalse(handler.getBackupFile().exists());
                    assertTrue(handler.getOriginalFile().exists());

                    looperThread.testComplete();
                })
                .build();

        Realm realm = Realm.getInstance(config);
        looperThread.addTestRealm(realm);

        // Trigger error
        SyncManager.simulateClientReset(SyncManager.getOrCreateSession(config, null));
    }

